language: smalltalk
sudo: false

os:
  - linux

smalltalk:
  - Pharo-6.1

# Unit tests run the normal pillar tests
# Integration tests test that pillar itself can interact with generated files, pdf generation, etc.
# System tests test that we can install and use pillar as a black box
env:
  matrix:
  - JOB=test TYPE=System ARCHETYPE=book OUTPUT=pdf

install:
  # Pillar installation
  - git clone https://github.com/pillar-markup/pillar.git -b newpipeline  # Clone pillar
  - cd pillar && ./scripts/build.sh && cd ..                              # Run pillar build script. Pillar will be built in `pwd`/build!
  - . pillar/scripts/ci/ensure_latex.sh                                   # Install latex
  - ./pillar/scripts/ci/ensure_book_dependencies.sh                       # Install latex dependencies required by pillar
  
script:
  - ./pillar/build/pillar build pdf

deploy:
- provider: bintray
  file: .bintray.json
  on:
    repo: SquareBracketAssociates/Booklet-Scraping
  skip_cleanup: true
  user: ducasse
  key:
    secure: XS7rMdYs4ukZgnu3e2QMQDj1XdcDn4nxaJbADNZBHA1VPTRjSK6hEr9BHaK+15yIeEf8SPNhrPHYvWheJs1hYjda8jybKVA4MdBeMfh2N7Y9Unqu1wrMT+YKnhk0a/C6J2gnL5W2g3tBB3z+shvT9rzfmuoJBqLvXJzcGuZ1gdBJjsodEsvJ9r6Yx+8OuNJOEV4iLXmIwhQ9alyhgYLgz78I5WSlPufUfoVpuZmeF07zuPATpgLs0Qr+yrC/iRugrpqH77lZzlpJ+vPmSW7GEm4dCir9sh3Ekis7FXWPfwrxybd7XqhIOOI5NyY2Cl7euVGYAYPLbTaY2GlWShnt4dD96Nz8cEV05H7U0Pmslu4sgeYcuumYHNzLMu8TvngQCJjbQX8T8wX08iGygROwJYsyOU2Y/o+rnlHPXtjzKDjbih5A7gQLjXmhZ1YePeaNAMDb+v35ZHmrEeqb8bQSL0/W3BR4k1Muy1bMeZDrAFZftBAl4v6cNqQVrffsNZ4ZoZ5C7mU1k8smWs5hto+V7yuZgwYe1FAYxzdZIkyOE2czGGTdvwTG00xjyM1sJpLbnsQNOmsqicSMt+H8NoQQgeMU5CYa4jWDnZ4ftfdBcI+t7hm0JPgYFrjU19Bl2UAH9v6a4Wjp+mx1O/Ro6WwGcQri5a1wVzSoA+5ETE9Uo64=
	
- provider: releases
  file: build/scrapingbook.pdf
  on:
    tags: true
  skip_cleanup: true
  api_key:
    secure: pRfu3fr35BzqQDi1ul0SubPSwO8zcyIidqLRZPz3XIrH4qoy1Zgnq785dmB7ziNQqH+VJyh7askSFY3JLxL0d4P0eUgj2ZDIOhJsUQQ/ihevOBWbxlMOoEPjQfzA11l8WrNCQ566KrcYiISRi7bCg698kPTWSRwOmmvqXOJe5zGkuUbVmMNUV2oxaNV4JC8kVyVWHYy0nNMLEX/hzRZRh1+8K34/ds+fZ7irLrbDWMbKGHCyuLCSqv+zJJdu99nWLTclrCxFzK4DEHaMlFiO7wkUpyQLwZ38EDnb3E7iv045jSqCx3XB+DMRG1Da2/9BIXl0mho5ELdEvfGVAbjI2no5FWd0H1cs4/banAePCFnM7ZscJBaPWgVajB7EzrcADJUoxpmU6+6n1aIC3CnjscfAHqSAKGv8CO/Jh+Uirc8ATRpSqa73f2Nnj9tRCqwCOnFOCEzu0w5l3Ppz2Qpif04P+QbebZehSVaBJ4W01R2i8Rac3IuZDhZVaek1X24HFxUOd/rvHpbhz8eeANdnsWCTkAm+0sD+iKsWKICRMxFZfCK/SPldAcjXZsOsEMTqfx7ZWyCc7GeesQWcmW+z3shziyQd9tdeArJWLwacly3hH3WeyuUD5JyPF9klvDBtHgTVajdU4yp+3oXsrtTmetnBz+RESxQGdLgZRlQBQog=
